version: '2.4'
services:
  dio_rocksdb:
      image: taniaesteves/rocksdb_dio:latest
      pid: host
      hostname: {{ target_hostname.stdoutÂ }}
      privileged: true
      mem_limit: 1024m
      blkio_config:
        device_write_bps:
          - path: /dev/sda
            rate: 200mb
      command: ycsbwklda 8 8 1024 dio-ycsbwklda-8-8-1024
      volumes:
        - /lib/modules:/lib/modules:ro
        - /usr/src:/usr/src:ro
        - /sys/kernel/debug/:/sys/kernel/debug/:ro
        - /tmp/dio:/tmp/dio
        - {{ rocksdb_dir }}/dio.yml:/usr/share/dio/conf/config.yaml:ro
        - {{ tracing_data_dir }}/dio/dio_data:/dio_data
        - {{ rocksdb_data_dir }}/rocksdb_data/kvstore:/rocks_db/workloads/kvstore
        - {{ rocksdb_data_dir }}/rocksdb_data/results:/rocks_db/workloads/results
      environment:
        - ROCKSDB_LOAD={{rocksdb_load}}
        - ROCKSDB_OPS={{rocksdb_ops}}
        - ROCKSDB_SCANOPS={{rocksdb_scanops}}
      stop_grace_period: 2m
